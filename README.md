# BankingTestTask

## Задание
Реализовать web-приложение для работы со счетами клиента. Клиент должен иметь возможность:

1. Пополнить счет.
2. Снять со счета.
3. Получить инфомацию по конкрентому счету.
4. Получить инфомацию по счетам на основе каких-то параметров.
5. Открыть счет.
6. Закрыть счет.

Внешний интерфейс приложения представлен в виде HTTP API.

Если необходимо тело запроса и ответа должны передаваться в формате JSON.<br>
Ожидаемые коды HTTP ответов:
1. 200 OK
2. 4xx
3. 5xx

## Обязательные требования:
1. Реализовано на Java+SpringBoot.
2. без UI.
3. СУБД Postgre. Поднимается рядом с приложением в докер-контейнере.
4. Основные компоненты приложения покрыты unit-тестами.
5. Flyway для версионирования схемы базы данных.
6. Применение REST практик.
7. Maven


## Описание решения:

Для большей приближенности к реальному описанию счета сущность банковского счекта (Account) содержит поля, не описанные в задании. Она состоит из:
 1. id - идентификатор записи о счете в БД.
 2. userId - внешний ключ к таблице Users (будет описана далее)
 3. divisionId - внешний ключ к таблице Divisions (будет описана далее)
 4. currencyId - внешний ключ к таблице Currencies (будет описана далее)
 5. accNumber - номер счета. Частично валидируется: по длине, not null. Так же в сервисном слое частично проверяется структура счета. Валидируется код валюты, в которой открыт счет и код отделения банка.
 6. corAcc - номер корреспондентского счета. Валидация реализована подобно accNumber. Из особенностей - проверка балансового счета первого и второго порядка. У кор. счета это всегда 30101
 7. balance - баланс счета. Допущения работы с ним описаны далее.
 8. timeOpen - таймштамп открытия счета.
 9. timeClose - таймштамп закрытия счет. Если null, счет активен
 10. user - сущность клиента-владельца счет
 11. division - сущность отделения, в котором открыт счет
 12. currency - сущность валюты, в которой открыт счет

Сущность Division:
 1. id - идентификатор
 2. name - название подразделения
 3. code - код подразделения, которое фигурирует в номере счета
 4. bic - БИК
 5. inn - ИНН

Сущность User:
 1. id - идентификатор
 2. fio - ФИО

Сущность Currency:
 1. id - идентификатор
 2. code - код валюты
 3. name - название ("RUB", "USD" и т.д.)

Применением аннотаций в теле ответа некоторые поля игнорируются. Пример тела:<br>
{<br>
    "accNumber": "12345840811114567891",<br>
    "corAcc": "30145840811114567891",<br>
    "balance": 0.00,<br>
    "timeOpen": "2024-06-24T00:29:56.000+00:00",<br>
    "timeClose": null,<br>
    "user": {<br>
        "fio": "Иванов Иван Иванович"<br>
    },<br>
    "division": {<br>
        "name": "Отделение 1 ПАО NБанк",<br>
        "bic": "123456780",<br>
        "inn": "7700000000"<br>
    },<br>
    "currency": {<br>
        "name": "USD",<br>
        "code": "840"<br>
    }<br>
}<br>


  1. Пополнение и снятие со счета реализованы обработкой запроса POST /api/v1/accounts/:accountId/changeBalance?value мотодом ResponseEntity<String> closeAccount(@PathVariable(name = "accountId") Long accountId) в контролеере AccountController.
Если value отрицательный, происходит списания со счета, иначе счет пополняется. В случае, если мы попытаемся изменить баланс закрытого счета или списать со счета, у которого баланс и так был отрицательным, будут выброшены соответствующие исключения. В случае успешного изменения баланса, в теле ответа будет содержаться новый баланс и код ответа 200. Длина вещественной части фиксирована на 2-х символах.

  2. Получение информации по по конкретному счету реализовано обработкой запроса GET /api/v1/accounts/:accountId методом Account getAccountById(@PathVariable("accountId") Long accountId) в контролеере AccountController. Возвращает статус 200 и искомый счет, если запрос успешен.

  3. Получение счетов на основе параметров реализовано обработкой запроса GET /api/v1/accounts?userId&active&closed&currencyName&balanceMoreThan&balanceLessThan&limit&offset методом public List<Account> getUsersAccounts в контролеере AccountController. Параметры запроса представляют собой фильтры, по которым отбираются записи счетов. active=true оставляет в выборке активные аккаунты, active=false исключает их. Аналогично для closed. По currencyName отбираем счета с интересущей валютой. По balanceMoreThan оставляем счета, у которых баланс больше значения параметра, balanceLessThan, у которых баланс меньше значения параметра. limit - огрничение записей ваыборки, offset - "сдвиг". **Допущение: поскольку мы работаем с счетами конкретного клиента, решил оставить параметр userId обязательным.**

  4. Открытие счета реализуется обработкой запроса POST /api/v1/accounts (в теле в формате json передается добавляемый счет) методом public ResponseEntity<Long> addAccount(@RequestBody Account account) в контроллере AccountController. Допущения: не разрешено добавлять закрытый счет, запрещено добавлять счет с отрицательным балансом.

  5. Закрытие счета реализуется обработкой запроса POST /api/v1/accounts/:accountId/close методом ResponseEntity<String> closeAccount(@PathVariable(name = "accountId") Long accountId) в контроллере AccountController. Допущения: нельзя закрыть уже закрытый счет

Были созданы миграции БД с созданием и тестовым наполнением таблиц (src/main/resources/db/migration).

Для развертывания БД написан Docker Compose файл (src/main/resources/docker/docker-compose.yaml). Так же можно воспользоваться командой docker run --name java-postgres -p 5434:5432 -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=admin -e POSTGRES_DB=BankingTestDB -d postgres

AccountServiceImpl и AccountController покрыты unit-тестами

Так же был добавлен Swagger (http://localhost:8080/swagger-ui/index.html).

